<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><meta http-equiv="Content-Style-Type" content="text/css" /><meta name="generator" content="Aspose.Words for .NET 15.1.0.0" /><title></title></head><body><div><p style="margin:0pt; orphans:0; text-align:center; widows:0"><span style="font-family:等线; font-size:14pt; font-weight:bold">简单版(对用户来说)策略的详细(hai</span><span style="font-family:等线; font-size:14pt; font-weight:bold"> kan bu dong </span><span style="font-family:等线; font-size:14pt; font-weight:bold">jiu</span><span style="font-family:等线; font-size:14pt; font-weight:bold"> kan si ni</span><span style="font-family:等线; font-size:14pt; font-weight:bold">)说明</span></p><p style="margin:0pt; orphans:0; widows:0"><span style="font-family:等线; font-size:10.5pt">&#xa0;</span></p><p style="margin:0pt; orphans:0; widows:0"><span style="width:21pt; text-indent:0pt; display:inline-block"></span><span style="font-family:等线; font-size:10.5pt">对于用户来说，一个策略对应多个 IF x</span><span style="font-family:等线; font-size:10.5pt"> THEN </span><span style="font-family:等线; font-size:10.5pt">y的组合。比如说，I</span><span style="font-family:等线; font-size:10.5pt">F </span><span style="font-family:等线; font-size:10.5pt">连续五天跌 THEN 卖出100股sh600036股票（x=连续5天跌，y=卖出</span><span style="font-family:等线; font-size:10.5pt">100股sh600036</span><span style="font-family:等线; font-size:10.5pt">股票)；</span></p><p style="margin:0pt; orphans:0; widows:0"><span style="font-family:等线; font-size:10.5pt">&#xa0;</span></p><p style="margin:0pt; orphans:0; widows:0"><span style="width:21pt; text-indent:0pt; display:inline-block"></span><span style="font-family:等线; font-size:10.5pt">又如，IF macd线由下向上突破0</span><span style="font-family:等线; font-size:10.5pt"> THEN </span><span style="font-family:等线; font-size:10.5pt">买入 100股sh600036；</span></p><p style="margin:0pt; orphans:0; widows:0"><span style="font-family:等线; font-size:10.5pt">&#xa0;</span></p><p style="margin:0pt; orphans:0; widows:0"><span style="width:21pt; text-indent:0pt; display:inline-block"></span><span style="font-family:等线; font-size:10.5pt">每个IF</span><span style="font-family:等线; font-size:10.5pt"> </span><span style="font-family:等线; font-size:10.5pt">x THEN</span><span style="font-family:等线; font-size:10.5pt"> </span><span style="font-family:等线; font-size:10.5pt">y称作一个Recipe，所以，一个策略</span><span style="font-family:等线; font-size:10.5pt">(</span><span style="font-family:等线; font-size:10.5pt">Strategy</span><span style="font-family:等线; font-size:10.5pt">)</span><span style="font-family:等线; font-size:10.5pt">等于多个Recipe的组合</span></p><p style="margin:0pt; orphans:0; widows:0"><span style="width:21pt; text-indent:0pt; display:inline-block"></span><span style="font-family:等线; font-size:10.5pt">比如，</span><span style="font-family:等线; font-size:10.5pt">某用户看好了sh600036，想在连续五天跌的时候卖出去，由想在macd线由下向上突破0时候买入，那么他制定的策略 =</span><span style="font-family:等线; font-size:10.5pt"> </span><span style="font-family:等线; font-size:10.5pt">[</span><span style="font-family:等线; font-size:10.5pt">R</span><span style="font-family:等线; font-size:10.5pt">ecipe1，Recipe2}</span></p><p style="margin:0pt; orphans:0; widows:0"><span style="width:21pt; text-indent:0pt; display:inline-block"></span></p><p style="margin:0pt; orphans:0; widows:0"><span style="width:21pt; text-indent:0pt; display:inline-block"></span><span style="font-family:等线; font-size:10.5pt">IF </span><span style="font-family:等线; font-size:10.5pt">x</span><span style="font-family:等线; font-size:10.5pt"> THEN </span><span style="font-family:等线; font-size:10.5pt">y</span><span style="font-family:等线; font-size:10.5pt"> </span><span style="font-family:等线; font-size:10.5pt">中，x</span><span style="font-family:等线; font-size:10.5pt"> </span><span style="font-family:等线; font-size:10.5pt">是条件(</span><span style="font-family:等线; font-size:10.5pt">C</span><span style="font-family:等线; font-size:10.5pt">ondition)，y是动作(</span><span style="font-family:等线; font-size:10.5pt">Action</span><span style="font-family:等线; font-size:10.5pt">)，显然应该要能够组合不同的条件和动作来组合出不同的Recipe，比如从上面两个Recipe的动作中，可以组合出 IF </span><span style="font-family:等线; font-size:10.5pt">连续五天跌</span><span style="font-family:等线; font-size:10.5pt"> THEN 买入</span><span style="font-family:等线; font-size:10.5pt">100股sh600036股票</span><span style="font-family:等线; font-size:10.5pt">。</span></p><p style="margin:0pt; orphans:0; widows:0"><span style="font-family:等线; font-size:10.5pt">&#xa0;</span></p><p style="margin:0pt; orphans:0; widows:0"><span style="width:21pt; text-indent:0pt; display:inline-block"></span><span style="background-color:#ff0000; font-family:等线; font-size:10.5pt">到这里</span><span style="font-family:等线; font-size:10.5pt">，用户可以做到的是，新建策略，新建Recipe（选择条件，选择动作），新建Recipe重复若干次，</span><span style="font-family:等线; font-size:10.5pt">编译策略</span><span style="font-family:等线; font-size:10.5pt">（转成python代码）</span><span style="font-family:等线; font-size:10.5pt">，</span><span style="font-family:等线; font-size:10.5pt">保存策略。</span></p><p style="margin:0pt; orphans:0; widows:0"><span style="font-family:等线; font-size:10.5pt">&#xa0;</span></p><p style="margin:0pt; orphans:0; widows:0"><span style="width:21pt; text-indent:0pt; display:inline-block"></span><span style="font-family:等线; font-size:10.5pt">但是具体</span><span style="font-family:等线; font-size:10.5pt">怎么编译</span><span style="font-family:等线; font-size:10.5pt">？显然只能人工写，比如说，一个条件，</span><span style="font-family:等线; font-size:10.5pt">叫短期滑动均线低于长期，写成python代码就是：</span></p><p style="margin:0pt; orphans:0; widows:0"><span style="font-family:等线; font-size:10.5pt">def handle_</span><span style="font-family:等线; font-size:10.5pt">data(</span><span style="font-family:等线; font-size:10.5pt">context, data):</span></p><p style="margin:0pt; orphans:0; widows:0"><span style="width:21pt; text-indent:0pt; display:inline-block"></span><span style="font-family:等线; font-size:10.5pt">short_avg = data.history(</span><span style="font-family:等线; font-size:10.5pt">symbol(</span><span style="font-family:等线; font-size:10.5pt">“sh600036”</span><span style="font-family:等线; font-size:10.5pt">)</span><span style="font-family:等线; font-size:10.5pt">, 'close', </span><span style="font-family:等线; font-size:10.5pt">9</span><span style="font-family:等线; font-size:10.5pt">, '1d').mean()</span><span style="font-family:等线; font-size:10.5pt"> # </span><span style="font-family:等线; font-size:10.5pt">9天收盘价平均</span></p><p style="margin:0pt; orphans:0; widows:0"><span style="width:21pt; text-indent:0pt; display:inline-block"></span><span style="font-family:等线; font-size:10.5pt">long_avg = </span><span style="font-family:等线; font-size:10.5pt">data.history(</span><span style="font-family:等线; font-size:10.5pt">symbol(“sh600036”)</span><span style="font-family:等线; font-size:10.5pt">, 'close',</span><span style="font-family:等线; font-size:10.5pt"> </span><span style="font-family:等线; font-size:10.5pt">16</span><span style="font-family:等线; font-size:10.5pt">, '1d').mean()</span><span style="font-family:等线; font-size:10.5pt"> # </span><span style="font-family:等线; font-size:10.5pt">16天收盘价平均</span></p><p style="margin:0pt; orphans:0; widows:0"><span style="font-family:等线; font-size:10.5pt">&#xa0;</span></p><p style="margin:0pt; orphans:0; widows:0"><span style="width:21pt; text-indent:0pt; display:inline-block"></span><span style="font-family:等线; font-size:10.5pt">if short_avg &lt; long_</span><span style="font-family:等线; font-size:10.5pt">avg :</span></p><p style="margin:0pt; orphans:0; widows:0"><span style="width:21pt; text-indent:0pt; display:inline-block"></span><span style="width:21pt; text-indent:0pt; display:inline-block"></span><span style="font-family:等线; font-size:10.5pt"># take action</span></p><p style="margin:0pt; orphans:0; widows:0"><span style="font-family:等线; font-size:10.5pt">&#xa0;</span></p><p style="margin:0pt; orphans:0; text-indent:21pt; widows:0"><span style="font-family:等线; font-size:10.5pt">在用户指定了动作之后，我们的工作就是把动作的代码放到 # take action的位置</span></p><p style="margin:0pt; orphans:0; widows:0"><span style="font-family:等线; font-size:10.5pt">&#xa0;</span></p><p style="margin:0pt; orphans:0; text-indent:21pt; widows:0"><span style="font-family:等线; font-size:10.5pt">由于条件和动作都是可以不断添加的，所以我们要定义一些格式，从而可以让我们按照这个格式来添加条件和</span><span style="font-family:等线; font-size:10.5pt">动作。那么我们的格式至少应该包括，条件/动作的名字，条件/动作的代码模板。</span></p><p style="margin:0pt; orphans:0; text-indent:21pt; widows:0"><span style="font-family:等线; font-size:10.5pt">只考虑这两个的话，把上面那个“</span><span style="font-family:等线; font-size:10.5pt">短期滑动均线低于长期</span><span style="font-family:等线; font-size:10.5pt">”条件翻译成格式，就是</span></p><p style="margin:0pt; orphans:0; text-indent:21pt; widows:0"><span style="font-family:等线; font-size:10.5pt">&#xa0;</span></p><p style="margin:0pt; orphans:0; widows:0"><span style="font-family:等线; font-size:10.5pt">&amp;&amp;name # &amp;&amp;开头表示一个区域标识，这里是名字, #后面是注释</span></p><p style="margin:0pt; orphans:0; widows:0"><span style="font-family:等线; font-size:10.5pt">mva_compare # 一个区域标识开始，直到文件结束或另一个区域标识之间是区域定义，name区域只识别第一行</span><span style="font-family:等线; font-size:10.5pt">（\n结束）</span><span style="font-family:等线; font-size:10.5pt">，且开头不为空，只含a-zA-Z0-9以及下划线，空格或换行表示结束</span></p><p style="margin:0pt; orphans:0; widows:0"><span style="font-family:等线; font-size:10.5pt">&#xa0;</span></p><p style="margin:0pt; orphans:0; widows:0"><span style="font-family:等线; font-size:10.5pt">&amp;&amp;compute # 计算条件表达式中要用到的变量的值,请正确填写python代码（以后出现在handle_data中）</span></p><p style="margin:0pt; orphans:0; widows:0"><span style="font-family:等线; font-size:10.5pt">short_avg = </span><span style="font-family:等线; font-size:10.5pt">data.history</span><span style="font-family:等线; font-size:10.5pt">(</span><span style="font-family:等线; font-size:10.5pt">symbol(“sh600036”)</span><span style="font-family:等线; font-size:10.5pt">, 'close', </span><span style="font-family:等线; font-size:10.5pt">9</span><span style="font-family:等线; font-size:10.5pt">, '1d').mean()</span></p><p style="margin:0pt; orphans:0; widows:0"><span style="font-family:等线; font-size:10.5pt">long_avg = </span><span style="font-family:等线; font-size:10.5pt">data.history</span><span style="font-family:等线; font-size:10.5pt">(</span><span style="font-family:等线; font-size:10.5pt">symbol(“sh600036”)</span><span style="font-family:等线; font-size:10.5pt">, 'close', </span><span style="font-family:等线; font-size:10.5pt">16</span><span style="font-family:等线; font-size:10.5pt">, '1d').mean()</span></p><p style="margin:0pt; orphans:0; widows:0"><span style="font-family:等线; font-size:10.5pt">&#xa0;</span></p><p style="margin:0pt; orphans:0; widows:0"><span style="font-family:等线; font-size:10.5pt">&amp;&amp;condition # 条件表达式</span></p><p style="margin:0pt; orphans:0; widows:0"><span style="font-family:等线; font-size:10.5pt">short_avg &lt; long_avg</span></p><p style="margin:0pt; orphans:0; widows:0"><span style="font-family:等线; font-size:10.5pt">&#xa0;</span></p><p style="margin:0pt; orphans:0; widows:0"><span style="width:21pt; text-indent:0pt; display:inline-block"></span><span style="background-color:#ff0000; font-family:等线; font-size:10.5pt">到这里</span><span style="font-family:等线; font-size:10.5pt">，</span><span style="font-family:等线; font-size:10.5pt">用户可以做到，自定义新的条件，自定义新的动作，因为定义这些的时候都是要通过写东西完成的，所以界面层提供一个文本框就好了</span></p><p style="margin:0pt; orphans:0; widows:0"><span style="font-family:等线; font-size:10.5pt">&#xa0;</span></p><p style="margin:0pt; orphans:0; widows:0"><span style="width:21pt; text-indent:0pt; display:inline-block"></span><span style="font-family:等线; font-size:10.5pt">但是只到这里的话，好像有点弱，因为写的太死了，比如动作那里只能</span><span style="font-family:等线; font-size:10.5pt">固定买</span><span style="font-family:等线; font-size:10.5pt">100股，万一我想买1000股，又要重写一个动作，显然比较坑。要搞定这个问题，就要引入变量。拿</span><span style="font-family:等线; font-size:10.5pt">“短期滑动均线低于长期”</span><span style="font-family:等线; font-size:10.5pt">这条件作为例子，假如我要的不是9天和16天，是7天和17天，要怎么做呢?在模板那里加点东西就好了</span></p><p style="margin:0pt; orphans:0; widows:0"><span style="font-family:等线; font-size:10.5pt">&#xa0;</span></p><p style="margin:0pt; orphans:0; widows:0"><span style="font-family:等线; font-size:10.5pt">&amp;&amp;name # &amp;&amp;开头表示一个区域标识，这里是名字, #后面是注释</span></p><p style="margin:0pt; orphans:0; widows:0"><span style="font-family:等线; font-size:10.5pt">mva_compare # 一个区域标识开始，直到文件结束或另一个区域标识之间是区域定义，name区域只识别第一行，且开头不为空，只含a-zA-Z0-9以及下划线，空格或换行表示结束</span></p><p style="margin:0pt; orphans:0; widows:0"><span style="font-family:等线; font-size:10.5pt">&#xa0;</span></p><p style="margin:0pt; orphans:0; widows:0"><span style="font-family:等线; font-size:10.5pt">&amp;&amp;description # 描述</span></p><p style="margin:0pt; orphans:0; widows:0"><span style="font-family:等线; font-size:10.5pt">to define a condition where short_mavg &lt; long_mavg # 可以任意字符任意行</span></p><p style="margin:0pt; orphans:0; widows:0"><span style="font-family:等线; font-size:10.5pt">&#xa0;</span></p><p style="margin:0pt; orphans:0; widows:0"><span style="background-color:#ffff00; font-family:等线; font-size:10.5pt">&amp;&amp;variable</span><span style="font-family:等线; font-size:10.5pt"> # 要被替换的变量</span></p><p style="margin:0pt; orphans:0; widows:0"><span style="background-color:#ffff00; font-family:等线; font-size:10.5pt">short_term</span><span style="background-color:#ffff00; font-family:等线; font-size:10.5pt">=9</span><span style="background-color:#ffff00; font-family:等线; font-size:10.5pt">, long_term</span><span style="background-color:#ffff00; font-family:等线; font-size:10.5pt">=16</span><span style="font-family:等线; font-size:10.5pt"> # 变量之间用逗号隔开，可以出现大小写数字下划线，开头不能是数字；变量</span><span style="font-family:等线; font-size:10.5pt">名不能</span><span style="font-family:等线; font-size:10.5pt">是stock（</span><span style="font-family:等线; font-size:10.5pt">已</span><span style="font-family:等线; font-size:10.5pt">默认使用）</span><span style="font-family:等线; font-size:10.5pt">;变量名后加=号表示默认值</span></p><p style="margin:0pt; orphans:0; widows:0"><span style="font-family:等线; font-size:10.5pt">&#xa0;</span></p><p style="margin:0pt; orphans:0; widows:0"><span style="font-family:等线; font-size:10.5pt">&amp;&amp;compute # 计算条件表达式中要用到的变量的值,请正确填写python代码（以后出现在handle_data中）</span></p><p style="margin:0pt; orphans:0; widows:0"><span style="font-family:等线; font-size:10.5pt">short_avg = </span><span style="font-family:等线; font-size:10.5pt">data.history</span><span style="font-family:等线; font-size:10.5pt">(</span><span style="font-family:等线; font-size:10.5pt">symbol(</span><span style="background-color:#ffff00; font-family:等线; font-size:10.5pt">$stock</span><span style="font-family:等线; font-size:10.5pt">)</span><span style="font-family:等线; font-size:10.5pt">, 'close', </span><span style="background-color:#ffff00; font-family:等线; font-size:10.5pt">$short_term</span><span style="font-family:等线; font-size:10.5pt">, '1d').mean()</span></p><p style="margin:0pt; orphans:0; widows:0"><span style="font-family:等线; font-size:10.5pt">long_avg = </span><span style="font-family:等线; font-size:10.5pt">data.history</span><span style="font-family:等线; font-size:10.5pt">(</span><span style="font-family:等线; font-size:10.5pt">symbol(</span><span style="background-color:#ffff00; font-family:等线; font-size:10.5pt">$stock</span><span style="font-family:等线; font-size:10.5pt">)</span><span style="font-family:等线; font-size:10.5pt">, 'close', </span><span style="background-color:#ffff00; font-family:等线; font-size:10.5pt">$long_term</span><span style="font-family:等线; font-size:10.5pt">, '1d').mean()</span></p><p style="margin:0pt; orphans:0; widows:0"><span style="font-family:等线; font-size:10.5pt">&#xa0;</span></p><p style="margin:0pt; orphans:0; widows:0"><span style="font-family:等线; font-size:10.5pt">&amp;&amp;condition # 条件表达式</span></p><p style="margin:0pt; orphans:0; widows:0"><span style="font-family:等线; font-size:10.5pt">short_avg &lt; long_avg</span></p><p style="margin:0pt; orphans:0; widows:0"><span style="font-family:等线; font-size:10.5pt">&#xa0;</span></p><p style="margin:0pt; orphans:0; text-indent:21pt; widows:0"><span style="font-family:等线; font-size:10.5pt">上面这样，就能够定义一次条件，但是适配到不同的策略里面去了，有人要9和16天，有人要7和17天，只要在选完条件之后多选一下就好了，没有默认值的变量一定要让用户填一下，有默认值的假如用户不改，那就是默认值。</span><span style="font-family:等线; font-size:10.5pt">而且有了变量，我们就可以指定要作用到的股票了。</span></p><p style="margin:0pt; orphans:0; text-indent:21pt; widows:0"><span style="font-family:等线; font-size:10.5pt">&#xa0;</span></p><p style="margin:0pt; orphans:0; text-indent:21pt; widows:0"><span style="background-color:#ff0000; font-family:等线; font-size:10.5pt">到这里</span><span style="font-family:等线; font-size:10.5pt">，用户可以做到，</span><span style="font-family:等线; font-size:10.5pt">新建策略</span><span style="font-family:等线; font-size:10.5pt">（</span><span style="background-color:#ffff00; font-family:等线; font-size:10.5pt">选择一支或一系列股票</span><span style="font-family:等线; font-size:10.5pt">）</span><span style="font-family:等线; font-size:10.5pt">，新建</span><span style="font-family:等线; font-size:10.5pt">Recipe（选择条件</span><span style="font-family:等线; font-size:10.5pt">（</span><span style="background-color:#ffff00; font-family:等线; font-size:10.5pt">并指定变量</span><span style="font-family:等线; font-size:10.5pt">）</span><span style="font-family:等线; font-size:10.5pt">，选择动作</span><span style="font-family:等线; font-size:10.5pt">（</span><span style="background-color:#ffff00; font-family:等线; font-size:10.5pt">并指定变量</span><span style="font-family:等线; font-size:10.5pt">）</span><span style="font-family:等线; font-size:10.5pt">），新建Recipe重复若干次，编译策略（转成python代码），保存策略。</span></p><p style="margin:0pt; orphans:0; text-indent:21pt; widows:0"><span style="font-family:等线; font-size:10.5pt">&#xa0;</span></p><p style="margin:0pt; orphans:0; text-indent:21pt; widows:0"><span style="font-family:等线; font-size:10.5pt">既然可以定义变量了，干脆也能定义常量吧。再加一点东西。</span></p><p style="margin:0pt; orphans:0; text-indent:21pt; widows:0"><span style="font-family:等线; font-size:10.5pt">&#xa0;</span></p><p style="margin:0pt; orphans:0; widows:0"><span style="font-family:等线; font-size:10.5pt">&amp;&amp;name # &amp;&amp;开头表示一个区域标识，这里是名字, #后面是注释</span></p><p style="margin:0pt; orphans:0; widows:0"><span style="font-family:等线; font-size:10.5pt">mva_compare # 一个区域标识开始，直到文件结束或另一个区域标识之间是区域定义，name区域只识别第一行，且开头不为空，只含a-zA-Z0-9以及下划线，空格或换行表示结束</span></p><p style="margin:0pt; orphans:0; widows:0"><span style="font-family:等线; font-size:10.5pt">&#xa0;</span></p><p style="margin:0pt; orphans:0; widows:0"><span style="font-family:等线; font-size:10.5pt">&amp;&amp;description # 描述</span></p><p style="margin:0pt; orphans:0; widows:0"><span style="font-family:等线; font-size:10.5pt">to define a condition where short_mavg &lt; long_mavg # 可以任意字符任意行</span></p><p style="margin:0pt; orphans:0; widows:0"><span style="font-family:等线; font-size:10.5pt">&#xa0;</span></p><p style="margin:0pt; orphans:0; widows:0"><span style="font-family:等线; font-size:10.5pt">&amp;&amp;variable # 要被替换的变量</span></p><p style="margin:0pt; orphans:0; widows:0"><span style="font-family:等线; font-size:10.5pt">max_share, short_term=9, long_term=16 # 变量之间用逗号隔开，可以出现大小写数字下划线，开头不能是数字；变量</span><span style="font-family:等线; font-size:10.5pt">名不能</span><span style="font-family:等线; font-size:10.5pt">是stock（默认使用）；变量名后加=号表示默认值</span></p><p style="margin:0pt; orphans:0; widows:0"><span style="font-family:等线; font-size:10.5pt">&#xa0;</span></p><p style="margin:0pt; orphans:0; widows:0"><span style="background-color:#ffff00; font-family:等线; font-size:10.5pt">&amp;&amp;const</span><span style="font-family:等线; font-size:10.5pt"> # 常量定义区域，请正确填写python代码（以后出现在initialize中）</span></p><p style="margin:0pt; orphans:0; widows:0"><span style="font-family:等线; font-size:10.5pt">from zipline.api import order, symbol</span></p><p style="margin:0pt; orphans:0; widows:0"><span style="background-color:#ffff00; font-family:等线; font-size:10.5pt">context.stock1 = symbol($stock)</span><span style="font-family:等线; font-size:10.5pt"> # $stock表示应用该策略的股票, 生成代码时候会替换成相应的股票代码，相当于stock是默认的变量</span></p><p style="margin:0pt; orphans:0; widows:0"><span style="font-family:等线; font-size:10.5pt">context.max_shares = $max_share # $跟着变量名，表示要替换成实际输入</span></p><p style="margin:0pt; orphans:0; widows:0"><span style="background-color:#ffff00; font-family:等线; font-size:10.5pt">def buy_buy_</span><span style="background-color:#ffff00; font-family:等线; font-size:10.5pt">buy(</span><span style="background-color:#ffff00; font-family:等线; font-size:10.5pt">):</span></p><p style="margin:0pt; orphans:0; widows:0"><span style="background-color:#ffff00; font-family:等线; font-size:10.5pt">    </span><span style="background-color:#ffff00; font-family:等线; font-size:10.5pt">order(</span><span style="background-color:#ffff00; font-family:等线; font-size:10.5pt">context.stock1, context.max_shares)</span></p><p style="margin:0pt; orphans:0; widows:0"><span style="font-family:等线; font-size:10.5pt">&#xa0;</span></p><p style="margin:0pt; orphans:0; widows:0"><span style="font-family:等线; font-size:10.5pt">&amp;&amp;compute # 计算条件表达式中要用到的变量的值,请正确填写python代码（以后出现在handle_data中）</span></p><p style="margin:0pt; orphans:0; widows:0"><span style="font-family:等线; font-size:10.5pt">short_avg = </span><span style="font-family:等线; font-size:10.5pt">data.history</span><span style="font-family:等线; font-size:10.5pt">(</span><span style="background-color:#ffff00; font-family:等线; font-size:10.5pt">context.stock1</span><span style="font-family:等线; font-size:10.5pt">, 'close', $short_term, '1d').mean()</span></p><p style="margin:0pt; orphans:0; widows:0"><span style="font-family:等线; font-size:10.5pt">long_avg = </span><span style="font-family:等线; font-size:10.5pt">data.history</span><span style="font-family:等线; font-size:10.5pt">(</span><span style="background-color:#ffff00; font-family:等线; font-size:10.5pt">context.stock1,</span><span style="font-family:等线; font-size:10.5pt"> 'close', $long_term, '1d').mean()</span></p><p style="margin:0pt; orphans:0; widows:0"><span style="font-family:等线; font-size:10.5pt">&#xa0;</span></p><p style="margin:0pt; orphans:0; widows:0"><span style="font-family:等线; font-size:10.5pt">&amp;&amp;condition # 条件表达式</span></p><p style="margin:0pt; orphans:0; widows:0"><span style="font-family:等线; font-size:10.5pt">short_avg &lt; long_avg</span></p><p style="margin:0pt; orphans:0; widows:0"><span style="font-family:等线; font-size:10.5pt">&#xa0;</span></p><p style="margin:0pt; orphans:0; widows:0"><span style="width:21pt; text-indent:0pt; display:inline-block"></span><span style="background-color:#ff0000; font-family:等线; font-size:10.5pt">到这里</span><span style="font-family:等线; font-size:10.5pt">，</span><span style="font-family:等线; font-size:10.5pt">用户可以在定义模板的时候多写点东西，不过对于界面层来说，还是只提供一个文本框就够了。</span></p><p style="margin:0pt; orphans:0; widows:0"><span style="font-family:等线; font-size:10.5pt">&#xa0;</span></p><p style="margin:0pt; orphans:0; widows:0"><span style="width:21pt; text-indent:0pt; display:inline-block"></span><span style="font-family:等线; font-size:10.5pt">最后，应该还要支持条件的and</span><span style="font-family:等线; font-size:10.5pt">,or,not</span><span style="font-family:等线; font-size:10.5pt">，以及动作的拼接（动作1</span><span style="font-family:等线; font-size:10.5pt">接动作</span><span style="font-family:等线; font-size:10.5pt">2），在动作里嵌套Recipe，这步不需要改模板格式。</span></p><p style="margin:0pt; orphans:0; widows:0"><span style="width:21pt; text-indent:0pt; display:inline-block"></span></p><p style="margin:0pt; orphans:0; widows:0"><span style="width:21pt; text-indent:0pt; display:inline-block"></span><span style="background-color:#ff0000; font-family:等线; font-size:10.5pt">到这里，</span><span style="font-family:等线; font-size:10.5pt">用户可以做到，新建策略（选择一支或一系列股票），新建</span><span style="font-family:等线; font-size:10.5pt">Recipe（选择条件（并指定变量），选择动作（并指定变量）），新建Recipe重复若干次，编译策略（转成python代码），保存策略。</span></p><p style="margin:0pt; orphans:0; widows:0"><span style="width:21pt; text-indent:0pt; display:inline-block"></span><span style="background-color:#ffff00; font-family:等线; font-size:10.5pt">选择条件时候</span><span style="font-family:等线; font-size:10.5pt">，可以点and/or，这时候，可以选两个条件，两个条件里面还可以选and/or；也可以选not，再点选别的</span></p><p style="margin:0pt; orphans:0; widows:0"><span style="width:21pt; text-indent:0pt; display:inline-block"></span><span style="background-color:#ffff00; font-family:等线; font-size:10.5pt">选择动作时候</span><span style="font-family:等线; font-size:10.5pt">，可以不断添加新动作，也可以不添加动作，而是添加Recipe</span></p></div></body></html>